################################################################################
# Tests:
################################################################################

FUNCTION(add_test_secrec_execute testfile)
    ADD_TEST(NAME "${testfile}"
        COMMAND $<TARGET_FILE:sca> --eval "${CMAKE_CURRENT_SOURCE_DIR}/${testfile}.sc")
ENDFUNCTION()

# Tests for scalars:
add_test_secrec_execute("scalars/00-trivial")
add_test_secrec_execute("scalars/01-true")
add_test_secrec_execute("scalars/02-decl")
add_test_secrec_execute("scalars/03-scope")
add_test_secrec_execute("scalars/04-function")
add_test_secrec_execute("scalars/05-assert-fail")
add_test_secrec_execute("scalars/05-declassify")
add_test_secrec_execute("scalars/06-rec")
add_test_secrec_execute("scalars/07-while")
add_test_secrec_execute("scalars/08-func-ret")
add_test_secrec_execute("scalars/09-global")
add_test_secrec_execute("scalars/10-if")
add_test_secrec_execute("scalars/11-empty-if")
add_test_secrec_execute("scalars/12-return")
add_test_secrec_execute("scalars/13-loop-bench")
add_test_secrec_execute("scalars/14-expressions")
add_test_secrec_execute("scalars/15-continue")
add_test_secrec_execute("scalars/16-break")
add_test_secrec_execute("scalars/17-for")
add_test_secrec_execute("scalars/18-for-empty-body")
add_test_secrec_execute("scalars/19-logic-public")
add_test_secrec_execute("scalars/20-logic-bug1")
add_test_secrec_execute("scalars/21-logic-private")
add_test_secrec_execute("scalars/22-ternary")
add_test_secrec_execute("scalars/23-uops-public")
add_test_secrec_execute("scalars/24-uops-private")
add_test_secrec_execute("scalars/25-assignops")
add_test_secrec_execute("scalars/26-do-while")
add_test_secrec_execute("scalars/27-do-while-bug")
add_test_secrec_execute("scalars/28-scope-bug")
add_test_secrec_execute("scalars/29-scope-bug-2")
add_test_secrec_execute("scalars/30-rec-bug")
add_test_secrec_execute("scalars/31-fib")
add_test_secrec_execute("scalars/32-overloading")
add_test_secrec_execute("scalars/33-string")
add_test_secrec_execute("scalars/34-print")
add_test_secrec_execute("scalars/35-prefix-incdec")
add_test_secrec_execute("scalars/36-postfix-incdec")
add_test_secrec_execute("scalars/37-for-decl")
add_test_secrec_execute("scalars/38-postfix-fail")
add_test_secrec_execute("scalars/39-int-types")
add_test_secrec_execute("scalars/40-casts")
add_test_secrec_execute("scalars/41-param-order")
add_test_secrec_execute("scalars/42-ra-fail")
add_test_secrec_execute("scalars/43-domain-fail")
add_test_secrec_execute("scalars/44-classify")
add_test_secrec_execute("scalars/45-return-type-overloading")
add_test_secrec_execute("scalars/46-domain-id")
add_test_secrec_execute("scalars/47-operator-overloading")
add_test_secrec_execute("scalars/48-multiple-var-decl")
add_test_secrec_execute("scalars/49-multiple-var-decl-bug")
add_test_secrec_execute("scalars/50-integer-types")
add_test_secrec_execute("scalars/51-qualified-expressions")
add_test_secrec_execute("scalars/52-empty-false-branch")
add_test_secrec_execute("scalars/53-for-loop-bug")
add_test_secrec_execute("scalars/54-Bug1478")

SET_TESTS_PROPERTIES("scalars/05-assert-fail" PROPERTIES PASS_REGULAR_EXPRESSION "assert failed at .*\\(3,3\\)\\(3,18\\)")
SET_TESTS_PROPERTIES("scalars/43-domain-fail" PROPERTIES PASS_REGULAR_EXPRESSION "[FATAL].*\\(9,5\\)\\(9,12\\)")
SET_TESTS_PROPERTIES("scalars/53-for-loop-bug" PROPERTIES PASS_REGULAR_EXPRESSION "[FATAL].*\\(3,32\\)\\(3,37\\)")

# Tests for arrays:
add_test_secrec_execute("arrays/00-trivia")
add_test_secrec_execute("arrays/01-size")
add_test_secrec_execute("arrays/02-expression")
add_test_secrec_execute("arrays/03-index")
add_test_secrec_execute("arrays/04-slice")
add_test_secrec_execute("arrays/05-simplicit")
add_test_secrec_execute("arrays/06-functions")
add_test_secrec_execute("arrays/07-dynamic-size")
add_test_secrec_execute("arrays/08-rec")
add_test_secrec_execute("arrays/09-reshape")
add_test_secrec_execute("arrays/10-shape")
add_test_secrec_execute("arrays/11-shape-change")
add_test_secrec_execute("arrays/12-big-expr")
add_test_secrec_execute("arrays/13-index-assing")
add_test_secrec_execute("arrays/14-index-assing-slice")
add_test_secrec_execute("arrays/15-index-assing-slice-2d")
add_test_secrec_execute("arrays/16-scalar-reshape")
add_test_secrec_execute("arrays/17-assign-op-index")
add_test_secrec_execute("arrays/18-nat")
add_test_secrec_execute("arrays/19-fibo")
add_test_secrec_execute("arrays/20-order")
add_test_secrec_execute("arrays/21-reshape-bug")
add_test_secrec_execute("arrays/22-ternary-bug")
add_test_secrec_execute("arrays/23-assign-bug")
add_test_secrec_execute("arrays/24-ternary")
add_test_secrec_execute("arrays/25-uops")
add_test_secrec_execute("arrays/26-classify")
add_test_secrec_execute("arrays/27-assign-op")
add_test_secrec_execute("arrays/28-primes")
add_test_secrec_execute("arrays/29-slice-suggar")
add_test_secrec_execute("arrays/30-concat")
add_test_secrec_execute("arrays/31-concat-2d")
add_test_secrec_execute("arrays/32-slice-order")
add_test_secrec_execute("arrays/33-concat-suggar")
add_test_secrec_execute("arrays/34-reshape-classify")
add_test_secrec_execute("arrays/35-cat-bug")
add_test_secrec_execute("arrays/36-slice-empty-dim")
add_test_secrec_execute("arrays/37-cat-empty")
add_test_secrec_execute("arrays/38-concat-empty-matrix-bug")
add_test_secrec_execute("arrays/39-size-of-assignment-expr")
add_test_secrec_execute("arrays/40-prefix-postfix-incdec")
add_test_secrec_execute("arrays/41-for-decl")
add_test_secrec_execute("arrays/42-inc-bug")
add_test_secrec_execute("arrays/43-arith-assignment-bug")
add_test_secrec_execute("arrays/44-casts")
add_test_secrec_execute("arrays/45-inc-bug-2")
add_test_secrec_execute("arrays/46-assignment-bug")
add_test_secrec_execute("arrays/47-out-of-bounds-bug")
add_test_secrec_execute("arrays/48-private-index-bug")
add_test_secrec_execute("arrays/49-private-concat-bug")
add_test_secrec_execute("arrays/50-slice-assign-bug")
add_test_secrec_execute("arrays/51-seq-assign-bug")

# Tests for templates:
add_test_secrec_execute("templates/00-trivial")
add_test_secrec_execute("templates/01-recursion")
add_test_secrec_execute("templates/02-kind-fail")
SET_TESTS_PROPERTIES("templates/02-kind-fail"
    PROPERTIES PASS_REGULAR_EXPRESSION "[FATAL].*\\(8,5\\)\\(8,19\\).")
add_test_secrec_execute("templates/03-kind")
add_test_secrec_execute("templates/04-multiparam")
add_test_secrec_execute("templates/05-multiparam-fail")
SET_TESTS_PROPERTIES("templates/05-multiparam-fail"
    PROPERTIES PASS_REGULAR_EXPRESSION "[FATAL].*\\(12,5\\)\\(12,15\\).")
add_test_secrec_execute("templates/06-instantiation-fail")
SET_TESTS_PROPERTIES("templates/06-instantiation-fail"
    PROPERTIES PASS_REGULAR_EXPRESSION "[FATAL].*\\(4,9\\)\\(4,10\\)")
add_test_secrec_execute("templates/07-strange-bug")
add_test_secrec_execute("templates/08-mutual-recursion")
add_test_secrec_execute("templates/09-recursive-call-of-different-instance")
add_test_secrec_execute("templates/10-overloading")
add_test_secrec_execute("templates/11-name-lookup")
add_test_secrec_execute("templates/12-return-type-overloading")
add_test_secrec_execute("templates/13-various")
add_test_secrec_execute("templates/14-ambiguous-lookup")
SET_TESTS_PROPERTIES("templates/14-ambiguous-lookup"
    PROPERTIES PASS_REGULAR_EXPRESSION "[FATAL].*\\(14,5\\)\\(14,15\\)")
add_test_secrec_execute("templates/15-unify-fail-bug")
SET_TESTS_PROPERTIES("templates/15-unify-fail-bug"
    PROPERTIES PASS_REGULAR_EXPRESSION "[FATAL].*\\(1,18\\)\\(1,19\\)")
add_test_secrec_execute("templates/16-is-scalar")
add_test_secrec_execute("templates/17-simple")
